

library(hamcrest)

test.approx <- function() {
	x <- c(2,2:4,4,4,5,5,7,7,7)
	y <- c(1:6, 5:4, 3:1)
	approx(x,y, xout=x)$y # warning
	(ay <- approx(x,y, xout=x, ties = "ordered")$y)
	stopifnot(ay == c(2,2,3,6,6,6,4,4,1,1,1))
	
}

test.massdist <- function() {
	n <- 10L
	y <- .C("massdist",
			x = c(-0.44577826, -1.20585657,  0.04112631,  0.63938841, -0.78655436, -0.38548930,
					-0.47586788,  0.71975069, -0.01850562, -1.37311776),
			xmass = rep.int(0.10, 10),
			nx = 10L,
			xlo =  -3.55375188693167,
			xhi = 2.90038481693167,
			y = double(2 * n),
			ny = n,	
			PACKAGE = "stats" )$y
	
	assertThat(y, closeTo(c(0.0000000, 0.0000000, 0.0000000, 0.1826441, 0.3199924, 0.3154393, 0.1819242,
							0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000,
							0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000), 0.001))
	
		
}

test.density <- function() {
  cat(c("testDensity Starting...\n"))
	x <- c(-0.44577826, -1.20585657,  0.04112631,  0.63938841, -0.78655436, -0.38548930,
		   -0.47586788,  0.71975069, -0.01850562, -1.37311776)


  d <- density(x)
	print(d)
	assertThat(d$bw, closeTo(0.3115, 0.0001))
	assertThat(mean(d$y), closeTo(0.2520675, 0.0001))
}

ignoreTestLm <- function() {
	x <- seq(1,15)
	y <- sin(x)
	fit <- lm(y~x)
}

test.lowess <- function() {
  x <- lowess(data.frame(a=c(1,1,2,2),b=c(3,4,2,1)))
  y <- structure(list(x = c(1, 1, 2, 2), y = c(3.5, 3.5, 1.5, 1.5)), .Names = c("x", "y"))
  assertThat(x, identicalTo(y))
}

test.optim <- function() {
  set.seed(1)
  fr <- function(x) {
    x1 <- x[1];
    x2 <- x[2];
    100 * (x2 - x1 * x1)^2 + (1 - x1)^2
  }
    grr <- function(x) {
    x1 <- x[1];
    x2 <- x[2];
    c(-400 * x1 * (x2 - x1 * x1) - 2 * (1 - x1), 200 * (x2 - x1 * x1))
  }
  expected <- structure(list(par = c(0x1.fffff67ee8016p-1, 0x1.ffffee46a067fp-1),
                             value = 0x1.fe9cee9b5b8ep-43,
                             counts = structure(c(47L, 47L), .Names = c('function', 'gradient')),
                             convergence = 0L,
                             message = 'CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH'),
                        .Names = c('par', 'value', 'counts', 'convergence', 'message'))

  assertThat(optim(c(-1.2,1), fr, grr, method = "L-BFGS-B"), identicalTo(expected))
}
