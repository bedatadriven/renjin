#
# Renjin : JVM-based interpreter for the R language for the statistical analysis
# Copyright Â© 2010-2019 BeDataDriven Groep B.V. and contributors
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, a copy is available at
# https://www.gnu.org/licenses/gpl-2.0.txt
#


library(hamcrest)

test.chol2inv.1 <- function() {
     expected <- structure(c(0x1.5206d006db071p-4, -0x1.419345c29d06p-9, 0x1.089170127c81cp-10,
    -0x1.419345c29d06p-9, 0x1.93e3d2c12125ep-14, -0x1.e86ef64983649p-15,
    0x1.089170127c81cp-10, -0x1.e86ef64983649p-15, 0x1.b1310a28deaacp-7
    ), .Dim = c(3L, 3L))


    assertThat(base:::chol2inv(x=structure(c(-7.07106781186548, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, 0.14142135623731,
    0.14142135623731, 0.14142135623731, 0.14142135623731, -180.31222920257,
    102.041658159793, 0.19075019403925, 0.180950274888249, 0.171150355737249,
    0.161350436586248, 0.151550517435248, 0.141750598284247, 0.131950679133247,
    0.122150759982246, 0.112350840831246, 0.102550921680245, 0.0927510025292446,
    0.0829510833782442, 0.0731511642272436, 0.0633512450762432, 0.0535513259252426,
    0.0437514067742421, 0.0339514876232416, 0.0241515684722411, 0.0143516493212406,
    0.00455173017024013, -0.00524818898076037, -0.0150481081317609,
    -0.0248480272827614, -0.0346479464337619, -0.0444478655847624,
    -0.0542477847357629, -0.0640477038867634, -0.0738476230377639,
    -0.0836475421887644, -0.0934474613397649, -0.103247380490765,
    -0.113047299641766, -0.122847218792766, -0.132647137943767, -0.142447057094767,
    -0.152246976245768, -0.162046895396768, -0.171846814547769, -0.181646733698769,
    -0.19144665284977, -0.20124657200077, -0.211046491151771, -0.220846410302771,
    -0.230646329453772, -0.240446248604772, -0.250246167755773, -0.260046086906773,
    -0.269846006057774, -0.254340355124515, 0.449430921015207, 8.69731047202134,
    0.321276119080676, 0.343329995050071, 0.0588282122940552, -0.164694379185781,
    -0.295321788935466, -0.22385879061392, -0.21920853787453, -0.104661273842304,
    -0.0612154482457058, -0.0621525234125655, -0.0705452562909453,
    0.00200808547742763, -0.0537573446990878, 0.0336544463720235,
    -0.100504806002977, -0.157992191756202, -0.010204904854937, 0.0488114010183756,
    -0.0727349149874846, -0.0333195384024895, -0.191204200717729,
    -0.210218666266626, 0.0508305200937163, 0.0403227962936868, -0.0198713274280819,
    0.0920061674498957, 0.2998479694255, 0.248661585126886, 0.0341902919002373,
    -0.0567163594231639, 0.111712176226984, 0.0474839524683785, 0.125125339149463,
    0.129036049492684, 0.277661260168564, 0.14950823096393, -0.0145238861207542,
    0.010275072262743, 0.0943505363658233, -0.113826088346344, -0.171312032277045,
    -0.00599867619345998, -0.0418352841181095, -0.0650741633236776,
    -0.113507084362235, 0.0185927554111472, 0.0890230166089048), .Dim = c(50L,
    3L), .Dimnames = list(c("1", "2", "3", "4", "5", "6", "7", "8",
    "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19",
    "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30",
    "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41",
    "42", "43", "44", "45", "46", "47", "48", "49", "50"), c("(Intercept)",
    "x", ""))))
    ,  identicalTo( expected, tol = 1e-6 ) )
}

test.chol2inv.2 <- function() {

  expected <- structure(c(0x1.ab21db946a13p-6, -0x1.68115bdc3813p-31, -0x1.3e569eddcf92ap-85,
    0x1.35492f829008bp-73, -0x1.003fd1235a9f4p-24, 0x1.3be57d6fbf31dp-90,
    0x1.50a3846b234fep-27, 0x1.0052213cd04dap-96, -0x1.d745f01762e37p-96,
    0x1.49bf29fecbbdep-98, -0x1.68115bdc3813p-31, 0x1.0268f206ec65fp+3,
    -0x1.2b5c851065957p-21, -0x1.261c04f89c386p-22, 0x1.b007da3a409abp-50,
    -0x1.3d3c1628d020ap-81, -0x1.1bc8634c64a52p-52, -0x1.05205b14d5a14p-84,
    0x1.33ad8c0d47e48p-84, -0x1.8d69c64dbfa4fp-108, -0x1.3e569eddcf92ap-85,
    -0x1.2b5c851065957p-21, 0x1.8ece08fcc0fedp+7, 0x1.54b28p-46,
    -0x1.80c2ap-66, -0x1.9c76826065cb7p-5, -0x1.20497b4f7727bp-101,
    -0x1.1d98583893f28p-6, 0x1.6931e9092943dp-8, 0x1.913f2e8808371p-75,
    0x1.35492f829008bp-73, -0x1.261c04f89c386p-22, 0x1.54b28p-46,
    0x1.8ece53f46c752p+7, -0x1.b8fc2cd8242d6p-10, 0x1.230c13abfe3dp-27,
    0x1.d0dc09536b42cp-96, 0x1.5a81065636657p-15, 0x1.3a96cf9f525edp-10,
    -0x1.b5941bd09ee5ep-84, -0x1.003fd1235a9f4p-24, 0x1.b007da3a409abp-50,
    -0x1.80c2ap-66, -0x1.b8fc2cd8242d6p-10, 0x1.4440f3cc4107fp-8,
    -0x1.ac02b38475d7ap-26, -0x1.93eb497b3470ep-46, 0x1.5b6f4000000aap-80,
    0x1.53076f70fb70dp-31, -0x1.095075aba8923p-102, 0x1.3be57d6fbf31dp-90,
    -0x1.3d3c1628d020ap-81, -0x1.9c76826065cb7p-5, 0x1.230c13abfe3dp-27,
    -0x1.ac02b38475d7ap-26, 0x1.d8f45938abdcfp-13, 0x1p-112, 0x1.275fc2d0dcaacp-18,
    -0x1.7590a508756ccp-20, -0x1.fbd3aae426729p-37, 0x1.50a3846b234fep-27,
    -0x1.1bc8634c64a52p-52, -0x1.20497b4f7727bp-101, 0x1.d0dc09536b42cp-96,
    -0x1.93eb497b3470ep-46, 0x1p-112, 0x1.630d67ab7f0c4p-9, 0x1.cp-103,
    -0x1.24c1c7p-115, 0x1.756004ec9c6aep-32, 0x1.0052213cd04dap-96,
    -0x1.05205b14d5a14p-84, -0x1.1d98583893f28p-6, 0x1.5a81065636657p-15,
    0x1.5b6f4000000aap-80, 0x1.275fc2d0dcaacp-18, 0x1.cp-103, 0x1.c493679107059p-8,
    -0x1.02871dfe16acdp-21, -0x1.8d7e182856bc9p-29, -0x1.d745f01762e37p-96,
    0x1.33ad8c0d47e48p-84, 0x1.6931e9092943dp-8, 0x1.3a96cf9f525edp-10,
    0x1.53076f70fb70dp-31, -0x1.7590a508756ccp-20, -0x1.24c1c7p-115,
    -0x1.02871dfe16acdp-21, 0x1.86cce4fa5c77cp-6, -0x1.59a4f1f4b41c9p-62,
    0x1.49bf29fecbbdep-98, -0x1.8d69c64dbfa4fp-108, 0x1.913f2e8808371p-75,
    -0x1.b5941bd09ee5ep-84, -0x1.095075aba8923p-102, -0x1.fbd3aae426729p-37,
    0x1.756004ec9c6aep-32, -0x1.8d7e182856bc9p-29, -0x1.59a4f1f4b41c9p-62,
    0x1.3659ab6bc20a4p-6), .Dim = c(10L, 10L))

  input <- structure(c(6.19339507602051, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5.02324111721458e-10,
               0.351900901161679, 0, 0, 0, 0, 0, 0, 0, 0, 2.2082802531306e-12,
               1.04305861588421e-09, 0.072908995231498, 0, 0, 0, 0, 0, 0, 0,
               6.30057571608235e-10, 4.83392579838586e-10, 5.96771866662364e-08,
               0.0708165657838894, 0, 0, 0, 0, 0, 0, 7.46840385941552e-05, 1.65419232384833e-10,
               8.19674071627272e-05, 0.0240776327408882, 14.2166568787125, 0,
               0, 0, 0, 0, 8.7432183987322e-09, 2.3282039431783e-07, 16.2739730890076,
               -1.37141509544715e-05, 0.001570534915311, 66.5898534286346, 0,
               0, 0, 0, -2.2400646196851e-05, 3.19760041566629e-14, -4.19996957243922e-15,
               1.99307479859504e-13, 1.17676464924164e-10, -5.54835992305972e-15,
               19.213600633273, 0, 0, 0, -3.76945167698697e-12, 2.48156409889647e-09,
               0.17366164248561, -0.000423825922885238, -1.00100678871759e-06,
               -0.042441074035903, -1.44254652751862e-13, 12.0335648340437,
               0, 0, -3.36303637957187e-11, -2.51696884379672e-10, -0.0158934475075686,
               -0.00356290964924414, -2.75951044079601e-07, 0.00388421771911596,
               -2.91227788947102e-18, 0.000242938673057609, 6.47489137783496,
               0, 4.01587729463698e-13, 5.5628926503489e-16, 3.89151122482512e-08,
               -6.47209095482353e-11, 1.04385131324459e-12, 4.42590013997858e-08,
               -3.44446728998705e-07, 1.83730506237278e-06, 1.00076018875072e-16,
               7.26580778483999), .Dim = c(10L, 10L), .Dimnames = list(c("seeds",
               "seeds.per.fruit", "synchrony", "fruit.set", "fruits", "flowers",
               "competition", "intensity", "moment", "size"), c("seeds", "seeds.per.fruit",
               "synchrony", "fruit.set", "fruits", "flowers", "competition",
               "intensity", "moment", "size")))

  actual <- chol2inv(x=input)

  assertThat(actual, identicalTo(expected))

}

test.chol2inv.99 <- function() {

 expected <- structure(c(0x1.a609ea91d80dep-6, -0x1.0a1e693006b71p-14, -0x1.f4d1f6aa7158dp-52,
        -0x1.80fb8976a3914p-58, -0x1.2015381a96702p-8, -0x1.85613deff919fp-59,
        0x1.5fa7d4ad6bfdcp-12, 0x1.2bb3c2c052fe1p-60, -0x1.56da0fd144389p-62,
        0x1.181ba8fbc54dp-66, -0x1.0a1e693006b71p-14, 0x1.638812594f1ebp+2,
        -0x1.adffad5562e14p-6, -0x1.a8639f4fca141p-7, 0x1.6b4deed0dbee7p-17,
        -0x1.73dcb5a92c641p-66, -0x1.bb7a053ec74acp-21, 0x1.a147b2f87a9f5p-61,
        -0x1.db03e6f44a7a4p-63, -0x1.78788b774fa5p-70, -0x1.f4d1f6aa7158dp-52,
        -0x1.adffad5562e14p-6, 0x1.260af16323625p+7, 0x1.00a3b05bf4p-14,
        0x1.ca4p-52, 0x1.2330f027c70b3p-5, -0x1.6134ad68b8ed5p-59, -0x1.1d0aed3112392p-1,
        0x1.9fe62f90447fdp-3, -0x1.73998d59340b1p-56, -0x1.80fb8976a3914p-58,
        -0x1.a8639f4fca141p-7, 0x1.00a3b05bf4p-14, 0x1.795cba08efdb1p+6,
        -0x1.bee7d94da0dbp-10, 0x1.efd4a9266a2b6p-13, 0x1.d86e86dae89a4p-65,
        0x1.90189f8538979p-4, 0x1.5cdf6f5856725p-4, 0x1.139b88e2ff0e6p-59,
        -0x1.2015381a96702p-8, 0x1.6b4deed0dbee7p-17, 0x1.ca4p-52, -0x1.bee7d94da0dbp-10,
        0x1.79c4b089543a7p-8, -0x1.6c94d6ba5d2f3p-11, -0x1.e0143659957e4p-15,
        -0x1.a20482f5934a2p-61, 0x1.41a6d5ae05433p-15, 0x1.344edb2426bdcp-69,
        -0x1.85613deff919fp-59, -0x1.73dcb5a92c641p-66, 0x1.2330f027c70b3p-5,
        0x1.efd4a9266a2b6p-13, -0x1.6c94d6ba5d2f3p-11, 0x1.46dc106b98f22p-12,
        -0x1.9c4p-69, -0x1.1a476aa717928p-13, 0x1.6f4213d95991ap-15,
        -0x1.76ac94d0bfa43p-20, 0x1.5fa7d4ad6bfdcp-12, -0x1.bb7a053ec74acp-21,
        -0x1.6134ad68b8ed5p-59, 0x1.d86e86dae89a4p-65, -0x1.e0143659957e4p-15,
        -0x1.9c4p-69, 0x1.596c39d44c3aep-9, 0x1.1p-69, 0x1.33ab6p-71,
        0x1.12855133e6f24p-15, 0x1.2bb3c2c052fe1p-60, 0x1.a147b2f87a9f5p-61,
        -0x1.1d0aed3112392p-1, 0x1.90189f8538979p-4, -0x1.a20482f5934a2p-61,
        -0x1.1a476aa717928p-13, 0x1.1p-69, 0x1.24467f7c90757p-7, -0x1.64e4606de436dp-11,
        -0x1.22c0b4ccf94ffp-12, -0x1.56da0fd144389p-62, -0x1.db03e6f44a7a4p-63,
        0x1.9fe62f90447fdp-3, 0x1.5cdf6f5856725p-4, 0x1.41a6d5ae05433p-15,
        0x1.6f4213d95991ap-15, 0x1.33ab6p-71, -0x1.64e4606de436dp-11,
        0x1.8167ad9778c2ep-6, -0x1.6f001d4e4d763p-29, 0x1.181ba8fbc54dp-66,
        -0x1.78788b774fa5p-70, -0x1.73998d59340b1p-56, 0x1.139b88e2ff0e6p-59,
        0x1.344edb2426bdcp-69, -0x1.76ac94d0bfa43p-20, 0x1.12855133e6f24p-15,
        -0x1.22c0b4ccf94ffp-12, -0x1.6f001d4e4d763p-29, 0x1.3675177adc056p-6
        ), .Dim = c(10L, 10L))


assertThat(chol2inv(x=structure(
      c(0x1.b8a404130a498p+2, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0,
        0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x1.7f12894cdf98fp-15, 0x1.b2761e1004019p-2,
        0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0,
        -0x1.070af644ad205p-8, 0x1.a82a78f57fd1cp-14, 0x1.8ac4e6f4e8795p-4,
        0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x1.9c2319c475b54p-14,
        0x1.bfed7b5ca35abp-15, -0x1.68ab39dc971dfp-8, 0x1.a8f91760f07ccp-4,
        0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x1.cffb538d36b4ep+2,
        -0x1.4fc7a458aac5ap-9, -0x1.60dd458b6b661p+0, -0x1.5604061c2f32fp-5,
        0x1.edb5a40b317ffp+3, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0,
        0x1.0a18d973f1d93p+4, -0x1.e575fa074e79ep-7, -0x1.6e34d4fb8259ep+3,
        -0x1.3eee477c84c54p-1, 0x1.15372569edbd4p+5, 0x1.c6a2c120be4b5p+5,
        0x0p+0, 0x0p+0, 0x0p+0, 0x0p+0, -0x1.70000eacfaa89p-1, 0x1.405eb91e988fep-14,
        -0x1.fbb3f7c0ce6abp-6, -0x1.6ae336c2a3592p-11, 0x1.56f6fcc32bf3bp-2,
        -0x1.b1abc61bb1f5fp-13, 0x1.37ad328d3b83bp+4, 0x0p+0, 0x0p+0,
        0x0p+0, -0x1.39ff32f3d31cap-10, 0x1.64777a1b1e3fp-8, 0x1.76f341423d24bp+2,
        -0x1.2d65f5d355f9p+0, 0x1.08f7efa9f7e8dp-1, 0x1.b42e88bb77424p-1,
        -0x1.12e53206f899ap-10, 0x1.53479e115fe57p+3, 0x0p+0, 0x0p+0,
        -0x1.16dfd53d028f3p-7, -0x1.cbecc1411718bp-11, -0x1.3cf18a4d26e2fp-1,
        -0x1.a25225c89cfc5p-2, -0x1.31d4d62618eeap-4, -0x1.4c40449cce5cbp-4,
        -0x1.fd2e269f6920ep-16, 0x1.3a2de682868e3p-2, 0x1.a148976e0f99ap+2,
        0x0p+0, 0x1.40f90ef0f1119p-9, 0x1.48b5fe2bb7c56p-14, 0x1.5beb17457a10cp-4,
        -0x1.1b007275969d9p-6, 0x1.38d5ede511f2bp-7, 0x1.10d6baf542ae1p-6,
        -0x1.13b979fc44172p-5, 0x1.3dbef126d166dp-3, 0x1.ed485dc35828cp-21,
                                0x1.d0ee74c82f8e7p+2),
     .Dim = c(10L, 10L),
     .Dimnames = list(
        c("seeds", "seeds.per.fruit", "synchrony",
            "fruit.set", "fruits", "flowers", "competition", "intensity",
            "moment", "size"),
        c("seeds", "seeds.per.fruit", "synchrony",
            "fruit.set", "fruits", "flowers", "competition", "intensity",
            "moment", "size")))),
    identicalTo( expected, tol = 1e-6 ) )

}